<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Kaigi on Rails 不参加記 Part1 | QWYNG.dev</title>
<meta property="og:title" content="Kaigi on Rails 不参加記 Part1 | QWYNG.dev"><meta name=twitter:title content="Kaigi on Rails 不参加記 Part1 | QWYNG.dev"><meta itemprop=name content="Kaigi on Rails 不参加記 Part1 | QWYNG.dev"><meta name=application-name content="Kaigi on Rails 不参加記 Part1 | QWYNG.dev"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:locale" content="ja"><meta name=language content="ja"><link rel=alternate hreflang=en href=https://qwyng.dev/posts/20231028/ title><meta property="og:type" content="article"><meta property="og:article:published_time" content=2023-10-28T22:53:27+0900><meta property="article:published_time" content=2023-10-28T22:53:27+0900><meta property="og:url" content="https://qwyng.dev/posts/20231028/"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Kaigi on Rails 不参加記 Part1","author":{"@type":"Person","name":""},"datePublished":"2023-10-28","description":"","wordCount":2390,"mainEntityOfPage":"True","dateModified":"2023-10-28","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"QWYNG.dev"}}</script><meta name=generator content="Hugo 0.134.0"><meta property="og:description" content="Kaigi on Rails 不参加記とは
Kaigi on Railsには参加してないけど最近Rails周りなんもキャッチアップしてないと焦っている人間による、公開されている資料を見ての適当な感想を書く記事です。
運営の方々、発表者の方々、資料まとめてくださっている@hassanさん、その他皆々様ありがとうございます！！！！！！！"><meta property="og:type" content="website"><meta property="og:title" content="Kaigi on Rails 不参加記 Part1 - QWYNG.dev"><meta property="og:url" content="https://qwyng.dev/posts/20231028/"><meta name=og:image content="https://qwyng.dev/"><meta name=twitter:card content="summary"><link rel=canonical href=https://qwyng.dev/posts/20231028/><link href=/style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://qwyng.dev/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=G-9JVVYL7X5D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9JVVYL7X5D")}</script></head><body data-theme class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://qwyng.dev/ class=logo><svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title/><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/about/>About</a></li><li><a class=menu-link href=/posts/>記事一覧</a></li><li><a class=menu-link href=/index.xml>RSS</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Kaigi on Rails 不参加記 Part1</h1><div class=post-meta><time datetime=2023-10-28T22:53:27+09:00 itemprop=datePublished>Oct 28, 2023</time></div></header><div class=page-content><h2 id=kaigi-on-rails-不参加記とは>Kaigi on Rails 不参加記とは</h2><p>Kaigi on Railsには参加してないけど最近Rails周りなんもキャッチアップしてないと焦っている人間による、公開されている資料を見ての適当な感想を書く記事です。<br>運営の方々、発表者の方々、<a href=https://qiita.com/Hassan/items/9cc836dd5bfb1aaaabac>資料まとめてくださっている</a>@hassanさん、その他皆々様ありがとうございます！！！！！！！</p><h2 id=資料ごとの感想>資料ごとの感想</h2><p><a href=https://speakerdeck.com/techouse/sukeraburuactive-jobs-with-sidekiq-enterprise-kaigi-on-rails-2023-day-1-suponsalt2>スケーラブルActive Jobs with Sidekiq Enterprise (Kaigi on Rails 2023 Day 1 スポンサーLT2)</a></p><ul><li>非同期処理をマネージするプロセスって終了する時がむずいよね&mldr;むずいと思ってるだけで僕がなにかしたことあるわけじゃないんだけどね&mldr;。</li><li>時間がかかる非同期処理を高頻度で実行しているプロダクトってデプロイとかどうしてるんだろう？</li><li>クラウドとかDocker周りでシグナルがいい感じに送れないみたいな問題をみたことがある。</li></ul><p><a href=https://speakerdeck.com/makicamel/bulletmarkrepairer-auto-corrector-for-n-plus-1-queries>BulletmarkRepairer: auto corrector for N+1 queries</a></p><ul><li>まず作ってるGemがすごい〜知恵の結晶だ。</li><li>includesどこに書くか問題だけど、N+1が問題になるのってだいたいview周りなので、コントローラに書くなぁ。<ul><li>モデルに書く時ってasoociationコレクションを全部みてなにか判定する時とか？（特異メソッドにはありそう）</li></ul></li><li>メモリを気にするほどの環境にいたことがないので大体includes呼んじゃいますね&mldr;。多分今の社だとちゃんと考えたほうが良い。</li><li>大量のデータを返す公開APIとかはちゃんと意識してpreloadとeager_loadを使い分けたい。</li><li>発行されるSQLの変化を確認して、自分の知らない隠された仕様がないか確認する。<ul><li>これちゃんとやってる人すごいよなぁ。かくありたい。</li></ul></li></ul><p><a href=https://speakerdeck.com/ikumatadokoro/httpwoshou-deshu-itexue-bu-huairuatupurodonoshi-zu-mi>HTTPを手で書いて学ぶ ファイルアップロードの仕組み - Speaker Deck</a></p><ul><li>実際に検証しててすごい。</li><li>ブラウザってすごいよね。</li><li>Railsってどこでmultipart/form-dataをパースしてるんだろう？<ul><li>Rackの諸々使ってるのかな</li><li><a href=https://github.com/rails/rails/blob/5b0b1bb62a7ad6719436098078b91d846d93c17a/actionpack/test/dispatch/request/multipart_params_parsing_test.rb>テスト</a>までみて探索をやめた。</li></ul></li></ul><p><a href="https://docs.google.com/presentation/d/1Y5ZPVfNNLlTeE5VsT-JbpuWDgF_q1RF6wJHH8JAFV0w/edit#slide=id.gf559c2d176_0_136">生きた Rails アプリケーションへの Delegated Types の導入 (Kaigi on Rails 2023)</a></p><ul><li><p>基本的にSTIするくらいならポリモーフィック関連を作って共通した振る舞いは(別モデル ≒ 別テーブル)に切り出しがち。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Smartphone</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ApplicationRecord</span>
</span></span><span style=display:flex><span>  belongs_to <span style=color:#e6db74>:smartphonable</span>, <span style=color:#e6db74>polymorphic</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Pixel</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ApplicationRecord</span>
</span></span><span style=display:flex><span>  has_one <span style=color:#e6db74>:smartphone</span>, <span style=color:#e6db74>as</span>: <span style=color:#e6db74>:smartphonable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IPhone</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ApplicationRecord</span>
</span></span><span style=display:flex><span>  has_one <span style=color:#e6db74>:smartphone</span>, <span style=color:#e6db74>as</span>: <span style=color:#e6db74>:smartphonable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div></li><li><p>delegated_typeってこの関連に、色々便利メソッド（<code>#iphone?</code>的なクラス判定とか）を追加してくれているだけであってるよね？</p></li><li><p>この構造はよく使うので、共通認識として名前がついて便利メソッドがついてくるのは良さそう。</p></li><li><p>この資料のすごいところは実際に運用中のサービスの構造を変化する過程まで書いてくれていること。</p></li><li><p>あと<code>deploy_history_bases</code>のPKをそのまま<code>ecs_deploy_histories</code>や<code>lambda_deploy_histories</code>のPKに使っているの良さそう。</p><ul><li>僕だったら<code>deploy_history_bases.deploy_historyable_id</code>みたいなカラム作っちゃうと思う。余計なカラム一つ減らせて良さそう。</li><li><a href=https://api.rubyonrails.org/classes/ActiveRecord/DelegatedType.html>RailsのAPIドキュメント</a>だと現状<code>deploy_history_bases.deploy_historyable_id</code>的なカラムを作ることを想定してそう。<ul><li>どっちも突き詰めたら違うメリットあるのかも。</li></ul></li></ul></li></ul><p><a href="https://docs.google.com/presentation/d/1g1npS_0WEylpDhCVtpqi9AEQk9kUs5-Wo8vRcteLsk0/edit#slide=id.g1276827f2e_0_5">Asynchronous Ruby With Fiber And Async</a></p><ul><li>Thread<ul><li>GILがあるもののIO待ちが多い処理では並行処理の効率は良さそう。（IO待ちの間に他のスレッドが動いているのは並列処理と呼んでいいのだろうか?）</li></ul></li><li>Fiber<ul><li>ユーザーレベルスレッドってやつだよね？Elixirで言うところのプロセス、Goで言うところのゴルーチンみたいなやつ。グリーンスレッドって呼ばれたりもするやつ。</li></ul></li><li>PumaもIO.selectつかってた気がする。Reactorパターンというやつらしい。<ul><li><a href=https://github.com/puma/puma/blob/master/docs/architecture.md>ドキュメント</a></li></ul></li><li>上のpumaのやつもそうだけどスケジューリング的なコードは確かに複雑になりがち。</li><li>正直AsyncGem仕組みは全然わからん</li><li>Trilogyってたまに聞くけどMySQLのクライアントライブラリなんすね。<ul><li>名前カッコ良すぎる。</li></ul></li><li>とりあえずThreadもFiberもRactorも全然わからん&mldr;<ul><li>昔、Ractorを使おうとしたことがあったけど、定数周りとかちゃんとRactorセーフ？にしないと行けないので大変だった記憶がある。</li><li>その時にRactorとFaradayで検索してたら面白いアプローチしているGem見つけたので貼っておきます。<ul><li><a href=https://github.com/dazuma/ractor-wrapper>https://github.com/dazuma/ractor-wrapper</a></li><li>Ractor間で共有できないオブジェクトをRactorでラップして共有するぞというやつ。</li><li>既存のGemをRactor対応させるのに使えそう。</li></ul></li><li>脱線してしまった。</li></ul></li></ul><p><a href=https://speakerdeck.com/willnet/exceptional-rails>Exceptional Rails</a></p><ul><li>僕が勝手に師匠だと思っている人は言いました。バックエンドが例外処理を丁寧にやることがユーザー体験につながると。<ul><li>はい。</li></ul></li><li>起きうるエラーを考えて適切にエラーコードなりメッセージを出したい所さん。</li><li>コントローラ内の例外、rescure_fromで拾ったりアクション内でresuceしたり色々カオスになりがち。</li><li>ErrorReporter初めて知りました！神機能！！！！</li><li>rackミドルウェアになにもかも任せてぇ&mldr;</li></ul><p><a href=https://speakerdeck.com/boro1234/yasasiiactiverecordnodbjie-sok-nosikumi>やさしいActiveRecordのDB接続のしくみ</a></p><ul><li>コネクションプールの中でアダプターオブジェクトつくってるんですね。<ul><li>アダプターオブジェクトがコネクションプールを持ってるイメージだった。</li></ul></li><li>私的には最後の知見の言語化がすごい資料だと思った。<ul><li>解明した事実を役立ちそうな知見にまで言語化しててすごい。</li></ul></li></ul><h2 id=まとめ>まとめ</h2><p>Kaigi on Railsの資料はどれも日々の業務に活かせるものばかりで参考になりますね。
当たり前だけど、RubyKaigiはRubyってスゲー！ってなるのが多くて、Kaigi on RailsはRails開発ってスゲー！ってなるのが多い。<br>今回はここまで！多分part2も書きます！次回は絶対参加するぞ！</p></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons></div><small class=footer_copyright>© 2024 .</small></footer><script src=https://qwyng.dev/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script></body></html>