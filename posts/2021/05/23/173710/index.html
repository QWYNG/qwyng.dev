<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>SECCON Beginners CTF 2021 writeup | QWYNG.dev</title>
<meta property="og:title" content="SECCON Beginners CTF 2021 writeup | QWYNG.dev"><meta name=twitter:title content="SECCON Beginners CTF 2021 writeup | QWYNG.dev"><meta itemprop=name content="SECCON Beginners CTF 2021 writeup | QWYNG.dev"><meta name=application-name content="SECCON Beginners CTF 2021 writeup | QWYNG.dev"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:locale" content="ja"><meta name=language content="ja"><link rel=alternate hreflang=en href=https://qwyng.dev/posts/2021/05/23/173710/ title><meta property="og:type" content="article"><meta property="og:article:published_time" content=2021-05-23T17:37:00+0900><meta property="article:published_time" content=2021-05-23T17:37:00+0900><meta property="og:url" content="https://qwyng.dev/posts/2021/05/23/173710/"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"SECCON Beginners CTF 2021 writeup","author":{"@type":"Person","name":""},"datePublished":"2021-05-23","description":"","wordCount":2473,"mainEntityOfPage":"True","dateModified":"2021-05-23","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"QWYNG.dev"}}</script><meta name=generator content="Hugo 0.134.0"><meta property="og:description" content="
@hyper0dietterã•ã‚“ã«èª˜ã‚ã‚Œã¦SECCON Beginners CTF 2021ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚
ãƒãƒ¼ãƒ ã®æœ€çµ‚é †ä½ã¯1033ç‚¹ã§157ä½ã§ã™ã€‚ä¸€æ™‚ã¯80ä½ã«ãªã£ã¦äºŒäººã§èˆˆå¥®ã—ã¦ã¾ã—ãŸã€‚"><meta property="og:type" content="website"><meta property="og:title" content="SECCON Beginners CTF 2021 writeup - QWYNG.dev"><meta property="og:url" content="https://qwyng.dev/posts/2021/05/23/173710/"><meta name=og:image content="https://qwyng.dev/"><meta name=twitter:card content="summary"><link rel=canonical href=https://qwyng.dev/posts/2021/05/23/173710/><link href=/style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://qwyng.dev/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=G-9JVVYL7X5D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9JVVYL7X5D")}</script></head><body data-theme class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://qwyng.dev/ class=logo><svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title/><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/about/>About</a></li><li><a class=menu-link href=/posts/>è¨˜äº‹ä¸€è¦§</a></li><li><a class=menu-link href=/index.xml>RSS</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>SECCON Beginners CTF 2021 writeup</h1><div class=post-meta><time datetime=2021-05-23T17:37:00+09:00 itemprop=datePublished>May 23, 2021</time></div></header><div class=page-content><body><p>@hyper0dietterã•ã‚“ã«èª˜ã‚ã‚Œã¦<a href=https://score.beginners.azure.noc.seccon.jp/>SECCON Beginners CTF 2021</a>ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚
ãƒãƒ¼ãƒ ã®æœ€çµ‚é †ä½ã¯1033ç‚¹ã§157ä½ã§ã™ã€‚ä¸€æ™‚ã¯80ä½ã«ãªã£ã¦äºŒäººã§èˆˆå¥®ã—ã¦ã¾ã—ãŸã€‚</p><p>è‡ªåˆ†ã¯ä¸»ã«Webã‚„ã£ã¦ã¾ã—ãŸã€‚æœ€å¾Œã®magicã¯ã‚ã‚“ã¾ã‚Šæ™‚é–“ã‚‚ãªãã¦é€šã›ãšã˜ã¾ã„ã€‚
@hyper0dietterã•ã‚“ã¯cryptoã§ãªã‚“ãŒã™ã”ã„æ•°å­¦ä½¿ã£ã¦ã¦ã™ã”ã‹ã£ãŸï¼ˆå°ä¸¦ï¼‰ã€‚</p><ul class=table-of-contents><li><a href=#Web>Web</a><ul><li><a href=#check_url>check_url</a></li><li><a href=#json>json</a></li><li><a href=#cant_use_db>cant_use_db</a></li></ul></li><li><a href=#misc>misc</a><ul><li><a href=#Mail_Address_Validator>Mail_Address_Validator</a></li></ul></li><li><a href=#%E6%84%9F%E6%83%B3>æ„Ÿæƒ³</a></li></ul><h3 id=Web>Web</h3><h4 id=check_url>check_url</h4><p>URLã‚’POSTã™ã‚‹ã¨ãã“ã«<a class=keyword href=http://d.hatena.ne.jp/keyword/curl>curl</a>ã—ã¦ãã‚Œã‚‹ã‚¢ãƒ—ãƒªã€‚</p><pre class="code lang-php" data-lang=php data-unlink> &lt;!-- HTML Template --&gt;
          &lt;?php
            error_reporting(0);
            if ($_SERVER["REMOTE_ADDR"] === "127.0.0.1"){
              echo "Hi, Admin or SSSSRFer&lt;br&gt;";
              echo "********************FLAG********************";
            }else{
              echo "Here, take this&lt;br&gt;";
              $url = $_GET["url"];
              if ($url !== "https://www.example.com"){
                $url = preg_replace("/[^a-zA-Z0-9\/:]+/u", "ğŸ‘»", $url); //Super sanitizing
              }
              if(stripos($url,"localhost") !== false || stripos($url,"apache") !== false){
                die("do not hack me!");
              }
              echo "URL: ".$url."&lt;br&gt;";
              $ch = curl_init();
              curl_setopt($ch, CURLOPT_URL, $url);
              curl_setopt($ch, CURLOPT_CONNECTTIMEOUT_MS, 2000);
              curl_setopt($ch, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS);
              echo "&lt;iframe srcdoc='";
              curl_exec($ch);
              echo "' width='750' height='500'&gt;&lt;/iframe&gt;";
              curl_close($ch);
            }
          ?&gt;
&lt;!-- HTML Template --&gt;
 </pre><p><a class=keyword href=http://d.hatena.ne.jp/keyword/localhost>localhost</a>ã«<a class=keyword href=http://d.hatena.ne.jp/keyword/curl>curl</a>ã•ã›ã‚‰ã‚Œã‚Œã°è‰¯ã„ã§ã™ã­ã€ã—ã‹ã—å˜ç´”ã«<a class=keyword href=http://d.hatena.ne.jp/keyword/localhost>localhost</a>æŒ‡å®šã™ã‚‹ã¨å¼¾ã‹ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚<br><code>curl 127.0.0.1</code>ã¯<a class=keyword href=http://d.hatena.ne.jp/keyword/%C0%B5%B5%AC%C9%BD%B8%BD>æ­£è¦è¡¨ç¾</a>ã®ç½®æ›ã«ã‚ˆã‚Š <code>.</code>ãŒç½®æ›ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚æœ€åˆã¯ <code>:</code>ãŒç½®æ›é™¤å¤–ã•ã‚Œã¦ã„ã‚‹ã®ã‚‚ã‚ã‚Š<a class=keyword href=http://d.hatena.ne.jp/keyword/ipv6>ipv6</a>ã§æŒ‡å®šã™ã‚Œã°è‰¯ã„ã®ã‹ã¨æ€ã„ã¾ã—ãŸãŒã€<a class=keyword href=http://d.hatena.ne.jp/keyword/curl>curl</a>ã«<a class=keyword href=http://d.hatena.ne.jp/keyword/ipv6>ipv6</a>ã‚¢ãƒ‰ãƒ¬ã‚¹ãã®ã¾ã¾æ¸¡ã™ã«ã¯<br><code>curl [0:0:0:0:0:ffff:7f00:0001]</code>
ã®ã‚ˆã†ã«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ããã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‰ã—ãã€<code>[</code>ãŒç½®æ›ã•ã‚Œã¦ã—ã¾ã„é§„ç›®ã§ã—ãŸã€‚<br>æœ€çµ‚çš„ã«<a class=keyword href=http://d.hatena.ne.jp/keyword/ipv4>ipv4</a>ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’<code>.</code> ç„¡ã—ã«ã™ã‚Œã°è‰¯ã„ã¨æ°—ã¥ã„ã¦16é€²æ•°ã«ã—ãŸã‚‰é€šã‚Šã¾ã—ãŸã€‚<code>0x7F000001</code>ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰POSTã™ã‚Œã°OKã€‚</p><h4 id=json><a class=keyword href=http://d.hatena.ne.jp/keyword/json>json</a></h4><p>ç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯<a class=keyword href=http://d.hatena.ne.jp/keyword/%A4%AB%A4%E9%A4%B7>ã‹ã‚‰ã—</a>ã‹æƒ…å ±é–²è¦§ã§ããªã„ï¼ˆã‚‰ã—ã„ï¼‰ç¤¾å†…ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
bffã‚¢ãƒ—ãƒªã¨<a class=keyword href=http://d.hatena.ne.jp/keyword/api>api</a>ã‚¢ãƒ—ãƒªã§åˆ¥ã‚Œã¦ã¾ã™ã€‚nginxã«ç›´æ¥ã¤ãªãŒã£ã¦ã„ã‚‹ã®ã¯bffã®ã¿ã€‚</p><pre class="code lang-go" data-lang=go data-unlink> // bff/main.go
package main

import (
    "bytes"
    "encoding/json"
    "io/ioutil"
    "net"
    "net/http"

    "github.com/gin-gonic/gin"
)

type Info struct {
    ID int `json:"id" binding:"required"`
}

// check if the accessed user is in the local network (192.168.111.0/24)
func checkLocal() gin.HandlerFunc {
    return func(c *gin.Context) {
        clientIP := c.ClientIP()
        ip := net.ParseIP(clientIP).To4()
        if ip[0] != byte(192) || ip[1] != byte(168) || ip[2] != byte(111) {
            c.HTML(200, "error.tmpl", gin.H{
                "ip": clientIP,
            })
            c.Abort()
            return
        }
    }
}

func main() {
    r := gin.Default()
    r.Use(checkLocal())
    r.LoadHTMLGlob("templates/*")

    r.GET("/", func(c *gin.Context) {
        c.HTML(200, "index.html", nil)
    })

    r.POST("/", func(c *gin.Context) {
        // get request body
        body, err := ioutil.ReadAll(c.Request.Body)
        if err != nil {
            c.JSON(400, gin.H{"error": "Failed to read body."})
            return
        }

        // parse json
        var info Info
        if err := json.Unmarshal(body, &amp;info); err != nil {
            c.JSON(400, gin.H{"error": "Invalid parameter."})
            return
        }

        // validation
        if info.ID &lt; 0 || info.ID &gt; 2 {
            c.JSON(400, gin.H{"error": "ID must be an integer between 0 and 2."})
            return
        }

        if info.ID == 2 {
            c.JSON(400, gin.H{"error": "It is forbidden to retrieve Flag from this BFF server."})
            return
        }

        // get data from api server
        req, err := http.NewRequest("POST", "http://api:8000", bytes.NewReader(body))
        if err != nil {
            c.JSON(400, gin.H{"error": "Failed to request API."})
            return
        }
        req.Header.Set("Content-Type", "application/json")
        client := new(http.Client)
        resp, err := client.Do(req)
        if err != nil {
            c.JSON(400, gin.H{"error": "Failed to request API."})
            return
        }
        defer resp.Body.Close()
        result, err := ioutil.ReadAll(resp.Body)
        if err != nil {
            c.JSON(400, gin.H{"error": "Failed to request API."})
            return
        }

        c.JSON(200, gin.H{"result": string(result)})
    })

    if err := r.Run(":8080"); err != nil {
        panic("server is not started")
    }
}
 </pre><pre class="code lang-go" data-lang=go data-unlink> // api/main.go
package main

import (
    "io/ioutil"
    "os"

    "github.com/buger/jsonparser"
    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.Default()

    r.POST("/", func(c *gin.Context) {
        body, err := ioutil.ReadAll(c.Request.Body)
        if err != nil {
            c.String(400, "Failed to read body")
            return
        }

        id, err := jsonparser.GetInt(body, "id")
        if err != nil {
            c.String(400, "Failed to parse json")
            return
        }

        if id == 0 {
            c.String(200, "The quick brown fox jumps over the lazy dog.")
            return
        }
        if id == 1 {
            c.String(200, "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.")
            return
        }
        if id == 2 {
            // Flag!!!
            flag := os.Getenv("FLAG")
            c.String(200, flag)
            return
        }

        c.String(400, "No data")
    })

    if err := r.Run(":8000"); err != nil {
        panic("server is not started")
    }
}
 </pre><p>ã“ã®å•é¡Œã¯ï¼’ã¤é–¢é–€ãŒã‚ã‚Šã¾ã™ã€‚<br>1ã¤ç›®ã¯bff/main.goã®<code>checkLocal()</code>ã®çªç ´ã§ã™ã€‚nginxã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚</p><pre class=code data-lang data-unlink> server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    location / {
        proxy_pass   http://bff:8080;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

} </pre><p><a href=https://nginx.org/en/docs/http/ngx_http_proxy_module.html#var_proxy_add_x_forwarded_for>$proxy_add_x_forwarded_for</a>ã‚’ãã®ã¾ã¾æ¸¡ã—ã¦ã‚‹ã®ã§X-Forwarded-Forã®æ”¹ã–ã‚“ã¯å®¹æ˜“ã§ã™ã€‚ãƒªã‚¯<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%A8%A5%B9>ã‚¨ã‚¹</a>ãƒˆãƒ˜ãƒƒãƒ€ã§X-Forwarded-Forã‚’ã„ã˜ã‚Œã°OKã€‚</p><p>2ã¤ç›®ã¯bffã§ã®<a class=keyword href=http://d.hatena.ne.jp/keyword/json>json</a>ãƒã‚§ãƒƒã‚¯ã®å›é¿ã§ã™ã€‚
<code>{ "id": 2 }</code>ã‚’<a class=keyword href=http://d.hatena.ne.jp/keyword/api>api</a>ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ãŸã„ã®ã§ã™ãŒã€bffã®ãƒã‚§ãƒƒã‚¯ã«å¼¾ã‹ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
bffã¨<a class=keyword href=http://d.hatena.ne.jp/keyword/api>api</a>ã®<a class=keyword href=http://d.hatena.ne.jp/keyword/json>json</a>ã®ãƒ‘ãƒ¼ã‚¹ã®ä»•æ–¹ãŒé•ã†ã“ã¨ã«ç€ç›®ã—ã¦ã€è©¦ã—ã«<code>{"id": 2, "id": 0}</code>ã‚’æ¸¡ã—ãŸã‚‰bffã®infoæ§‹é€ ä½“ã«ã¯0ãŒ<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%DE%A5%C3%A5%D4%A5%F3%A5%B0>ãƒãƒƒãƒ”ãƒ³ã‚°</a>ã•ã‚Œã¦ã€<a class=keyword href=http://d.hatena.ne.jp/keyword/api>api</a>ã®<code>jsonparser.GetInt(body, "id")</code>ã§ã¯2ã‚’æ¸¡ã›ãŸã®ã§ã“ã‚Œã§è§£ã‘ã¾ã—ãŸã€‚</p><pre class=code data-lang data-unlink> curl -k  'https://json.quals.beginners.seccon.jp/' \
    -X POST \
  -H 'X-Forwarded-For:192.168.111.0' \
  -d '{"id": 2, "id": 0}' </pre><h4 id=cant_use_db>cant_use_db</h4><p>DBã§ã¯ãªã<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%D5%A5%A1%A5%A4%A5%EB%A5%B7%A5%B9%A5%C6%A5%E0>ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ </a>ã«ç›´æ¥writeã—ã¦æƒ…å ±ã‚’æ°¸ç¶šåŒ–ã—ã¦ã‚‹ã‚¢ãƒ—ãƒªã€‚</p><pre class="code lang-python" data-lang=python data-unlink> import os
import re
import time
import random
import shutil
import secrets
import datetime
from flask import Flask, render_template, session, redirect

app = Flask(__name__)
app.secret_key = secrets.token_bytes(256)


def init_userdata(user_id):
    try:
        os.makedirs(f"./users/{user_id}", exist_ok=True)
        open(f"./users/{user_id}/balance.txt", "w").write("20000")
        open(f"./users/{user_id}/noodles.txt", "w").write("0")
        open(f"./users/{user_id}/soup.txt", "w").write("0")
        return True
    except:
        return False


def get_userdata(user_id):
    try:
        balance = open(f"./users/{user_id}/balance.txt").read()
        noodles = open(f"./users/{user_id}/noodles.txt").read()
        soup = open(f"./users/{user_id}/soup.txt").read()
        return [int(i) for i in [balance, noodles, soup]]
    except:
        return [0] * 3


@app.route("/")
def top_page():
    user_id = session.get("user")
    if not user_id:
        dirnames = datetime.datetime.now()
        user_id = f"{dirnames.hour}{dirnames.minute}/" + secrets.token_urlsafe(30)
        if not init_userdata(user_id):
            return redirect("/")
        session["user"] = user_id
    userdata = get_userdata(user_id)
    info = {
        "user_id": re.sub("^[0-9]*?/", "", user_id),
        "balance": userdata[0],
        "noodles": userdata[1],
        "soup": userdata[2]
    }
    return render_template("index.html", info = info)


@app.route("/buy_noodles", methods=["POST"])
def buy_noodles():
    user_id = session.get("user")
    if not user_id:
        return redirect("/")
    balance, noodles, soup = get_userdata(user_id)
    if balance &gt;= 10000:
        noodles += 1
        open(f"./users/{user_id}/noodles.txt", "w").write(str(noodles))
        time.sleep(random.uniform(-0.2, 0.2) + 1.0)
        balance -= 10000
        open(f"./users/{user_id}/balance.txt", "w").write(str(balance))
        return "ğŸ’¸$10000"
    return "ERROR: INSUFFICIENT FUNDS"


@app.route("/buy_soup", methods=["POST"])
def buy_soup():
    user_id = session.get("user")
    if not user_id:
        return redirect("/")
    balance, noodles, soup = get_userdata(user_id)
    if balance &gt;= 20000:
        soup += 1
        open(f"./users/{user_id}/soup.txt", "w").write(str(soup))
        time.sleep(random.uniform(-0.2, 0.2) + 1.0)
        balance -= 20000
        open(f"./users/{user_id}/balance.txt", "w").write(str(balance))
        return "ğŸ’¸ğŸ’¸$20000"
    return "ERROR: INSUFFICIENT FUNDS"


@app.route("/eat")
def eat():
    user_id = session.get("user")
    if not user_id:
        return redirect("/")
    balance, noodles, soup = get_userdata(user_id)
    shutil.rmtree(f"./users/{user_id}/")
    session["user"] = None
    if (noodles &gt;= 2) and (soup &gt;= 1):
        return os.getenv("CTF4B_FLAG")
    if (noodles &gt;= 2):
        return "The noodles seem to get stuck in my throat."
    if (soup &gt;= 1):
        return "This is soup, not ramen."
    return "Please make ramen."


if __name__ == "__main__":
    app.run()
 </pre><p>ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã«æ‰€æŒé‡‘20000å††ã§40000å††åˆ†ã®è²·ã„ç‰©ã‚’ã—ã¦ã­ã¨ã„ã†å•é¡Œã€‚å½“ç„¶æ™®é€šã«é †ç•ªã«POSTã—ã¦ã‚‚è§£ã‘ãªã„ã§ã™ã€‚<br>ç€çœ¼ç‚¹ã¯æ˜ã‚‰ã‹ã«æ€ªã—ã„<code>time.sleep(random.uniform(-0.2, 0.2) + 1.0)</code>ã§ã™ã€‚<br>è²·ã„ç‰©å‡¦ç†ä¸­ã«åˆ¥ã®è²·ã„ç‰©ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç™ºç«ã•ã›ã‚Œã°ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒbalanceã‚’æ›¸ãæ›ãˆã‚‹å‰ã«balanceãƒã‚§ãƒƒã‚¯ã‚’çªç ´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã ã‘ã‚»ãƒƒãƒˆã—ã¦éåŒæœŸã§<a class=keyword href=http://d.hatena.ne.jp/keyword/curl>curl</a>ã€‚</p><pre class=code data-lang data-unlink> curl -k  'https://cant-use-db.quals.beginners.seccon.jp/buy_soup' \
      -X 'POST' \
      -H 'cookie: session=SESSION' &amp;
  curl -k  'https://cant-use-db.quals.beginners.seccon.jp/buy_noodles' \
      -X 'POST' \
      -H 'cookie: session=SESSION' &amp;
  curl -k  'https://cant-use-db.quals.beginners.seccon.jp/buy_noodles' \
      -X 'POST' \
      -H 'cookie: session=SESSION'
 </pre><p>ã“ã®å¾ŒåŒã˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¤ã‹ã£ã¦/eatã‚’GETã™ã‚Œã°OKã€‚</p><h3 id=misc>misc</h3><h4 id=Mail_Address_Validator>Mail_Address_Validator</h4><pre class="code lang-ruby" data-lang=ruby data-unlink> #!/usr/bin/env ruby
require 'timeout'

$stdout.sync = true
$stdin.sync = true

pattern = /\A([\w+\-].?)+@[a-z\d\-]+(\.[a-z]+)*\.[a-z]+\z/i

begin
  Timeout.timeout(60) {
    Process.wait Process.fork {
      puts "I check your mail address."
      puts "please puts your mail address."
      input = gets.chomp
      begin
        Timeout.timeout(5) {
          if input =~ pattern
            puts "Valid mail address!"
          else
            puts "Invalid mail address!"
          end
        }
      rescue Timeout::Error
        exit(status=14)
      end
    }
    
    case Process.last_status.to_i &gt;&gt; 8
    when 0 then
      puts "bye."
    when 1 then
      puts "bye."
    when 14 then
      File.open("flag.txt", "r") do |f|
        puts f.read
      end
    else
      puts "What's happen?"
    end
  } 
rescue Timeout::Error
  puts "bye."
end
 </pre><p>ã„ã‚ã‚†ã‚‹Redosã®å•é¡Œã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã™ã‚‹<a class=keyword href=http://d.hatena.ne.jp/keyword/%C0%B5%B5%AC%C9%BD%B8%BD>æ­£è¦è¡¨ç¾</a>ã®ãƒã‚§ãƒƒã‚¯ã«è² è·ã‚’ã‹ã‘ã‚ã¨ã„ã†ã‚‚ã®ã€‚ä¸€å¿œ60ç§’ã®åˆ¶é™ã‚‚ã‚ã‚Šã‚¯ã‚½ãƒ‡ã‚«æ–‡å­—åˆ—ã§ã¯çªç ´ã§ãã¾ã›ã‚“ã€‚</p><p>ã“ã®å•é¡Œã«ã¤ã„ã¦ã¯éŠ€åº§<a class=keyword href=http://d.hatena.ne.jp/keyword/Rails>Rails</a>ã§å…¨ãåŒã˜è©±ã‚’èã„ãŸã“ã¨ãŒã‚ã£ãŸã®ã§ãã®æ–¹ã®ç´ æ™´ã‚‰ã—ã„è³‡æ–™ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚</p><p><iframe id=talk_frame_512169 src=//speakerdeck.com/player/ea7667a08d3e4a7ab7cd5c1ef5352d46 width=710 height=532 style="border:0;padding:0;margin:0;background:0 0" frameborder=0 allowtransparency=true allowfullscreen mozallowfullscreen=true webkitallowfullscreen=true></iframe> <cite class=hatena-citation><a href=https://speakerdeck.com/expajp/sofalsezheng-gui-biao-xian-yi-yi-ari-redosnituite>speakerdeck.com</a></cite></p><pre class=code data-lang data-unlink> ~  nc mail-address-validator.quals.beginners.seccon.jp 5100

I check your mail address.
please puts your mail address.
username@host.abcde.abcde.abcde.abcde.abcde.abcde.abcde.abcde.abcde. </pre><p>ã§OK</p><h3 id=æ„Ÿæƒ³>æ„Ÿæƒ³</h3><p>webã®æœ€åˆã®å•é¡ŒãŒæ™‚äº‹ãƒã‚¿ã§ç¬‘ã„ã¾ã—ãŸã€‚äº‹ä»¶ã‚’èã„ã¦ä½œæˆã—ãŸã®ã‹å…ƒã€…ã“ã®å•é¡Œã ã£ãŸã®ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚<br>CTFã®webã‚’è§£ã„ã¦ã„ã‚‹ã¨ã„ã¤ã‚‚æ„Ÿã˜ã‚‹ã“ã¨ã§ã™ãŒã€å…¸å‹çš„ãªã‚‚ã®ã‚‚å¤šã„ã—æ˜ã‚‰ã‹ã«ãƒ¤ãƒã„ã‚³ãƒ¼ãƒ‰ã®å®Ÿä¾‹ãŒã‚ã‹ã‚‹ã®ã§ã€Webç³»ä¼æ¥­ã®ç ”ä¿®ã«æœ€é©ã ã¨æ€ã„ã¾ã™ã€‚è‡ªåˆ†ã‚‚X-Forwarded-Forã¯ã“ã®å•é¡Œã§åˆã‚ã¦çŸ¥ã‚Šã¾ã—ãŸã€‚<br>é‹å–¶ã®çš†æ§˜ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚æ¥½ã—ã‹ã£ãŸã§ã™ã€‚</p></body></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons></div><small class=footer_copyright>Â© 2024 .</small></footer><script src=https://qwyng.dev/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script></body></html>