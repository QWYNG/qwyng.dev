<!doctype html><html lang=ja data-theme>
<head>
<meta charset=utf-8>
<meta name=HandheldFriendly content="True">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer-when-downgrade">
<title>Railsでよく使用されるマルチテナントGemのテナントの初期化について - QWYNG.dev</title>
<meta name=description content="このエントリは、SmartHR Advent Calendar 2022の7日目です。 SmartHRではマルチテナントの実現のために activerecord-multi-">
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<link rel=stylesheet href=https://qwyng.dev/css/style.min.a11b8916e7fc33d397d735329bc39b452eba5901a3c1a497fadc20be86f83e54.css integrity="sha256-oRuJFuf8M9OX1zUym8ObRS66WQGjwaSX+twgvob4PlQ=">
<meta property="og:description" content="このエントリは、SmartHR Advent Calendar 2022の7日目です。 SmartHRではマルチテナントの実現のために activerecord-multi-">
<meta property="og:type" content="website">
<meta property="og:title" content="Railsでよく使用されるマルチテナントGemのテナントの初期化について - QWYNG.dev">
<meta property="og:url" content="https://qwyng.dev/posts/shr_advent_calendar2022/">
<meta name=og:image content="/reset.png">
<meta name=twitter:card content="summary">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9JVVYL7X5D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9JVVYL7X5D',{anonymize_ip:!1})}</script>
</head>
<body>
<a class=skip-main href=#main>Skip to main content</a>
<div class=container>
<header class=common-header>
<div class=header-top>
<h1 class=site-title>
<a href=/>QWYNG.dev</a>
</h1>
<ul class=social-icons>
<li>
<a href=https://github.com/QWYNG title=Github rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span>
</a>
</li>
<li>
<a href=https://twitter.com/qwyngg title=Twitter rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span>
</a>
</li>
<li>
<a href=mailto:ikusawasi@gmail.com title=Email rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M464 64H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 4e2V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V4e2H48z"/></svg>
</span>
</a>
</li>
</ul>
</div>
<nav>
<a href=https://qwyng.dev/about/ title>About</a>
<a href=https://qwyng.dev/posts/ title>記事一覧</a>
<a href=https://qwyng.dev/index.xml title>RSS</a>
</nav>
</header>
<main id=main tabindex=-1>
<article class="post h-entry">
<div class=post-header>
<header>
<h1 class="p-name post-title">Railsでよく使用されるマルチテナントGemのテナントの初期化について</h1>
</header>
</div>
<div class="content e-content">
<p>このエントリは、<a href=https://qiita.com/advent-calendar/2022/smarthr>SmartHR Advent Calendar 2022</a>の7日目です。</p>
<p>SmartHRではマルチテナントの実現のために <a href=https://github.com/citusdata/activerecord-multi-tenant>activerecord-multi-tenant</a>というGemを使っているのですが、そのGemを調査したときに気づいたことを書きたいと思います。</p>
<h3 id=tldr>TL;DR
<span><a href=#tldr>#</a></span>
</h3><ul>
<li><code>activerecord-multi-tenant</code>と<code>ActsAsTenant</code>はリクエストごとにテナントを初期化するタイミングが違うよ。</li>
<li>とくにrequest specでは誤ったテストの原因になりかねないので、テナントが初期化されるタイミングを理解して実際のアプリケーションの動作になるだけ近づけよう。</li>
</ul>
<h3 id=テナントのリセットタイミングの再現コード>テナントのリセットタイミングの再現コード
<span><a href=#%e3%83%86%e3%83%8a%e3%83%b3%e3%83%88%e3%81%ae%e3%83%aa%e3%82%bb%e3%83%83%e3%83%88%e3%82%bf%e3%82%a4%e3%83%9f%e3%83%b3%e3%82%b0%e3%81%ae%e5%86%8d%e7%8f%be%e3%82%b3%e3%83%bc%e3%83%89>#</a></span>
</h3><p>Railsにおいてマルチテナントを行う際に有力な選択肢として</p>
<ul>
<li><a href=https://github.com/ErwinM/acts_as_tenant>ActsAsTenant</a></li>
<li><a href=https://github.com/citusdata/activerecord-multi-tenant>activerecord-multi-tenant</a></li>
</ul>
<p>あたりが有力な選択肢になるかと思われます。
（<a href=https://github.com/rails-on-services/apartment>Apartment</a>も有名ですが先述の２つのGemと異なりマルチスキーマでマルチテナントを構成するGemで検証が間に合わなかったので言及しません :bow: )<br>
どちらのGemもリクエストごとに設定されているテナントを初期化してくれる機能が提供されていますが、その初期化をするタイミングが微妙に異なっています。<br>
↓サンプルコードです。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>require <span style=color:#e6db74>&#39;bundler/inline&#39;</span>

gemfile(<span style=color:#66d9ef>true</span>) <span style=color:#66d9ef>do</span>
  source <span style=color:#e6db74>&#39;https://rubygems.org&#39;</span>

  gem <span style=color:#e6db74>&#39;rails&#39;</span>, <span style=color:#e6db74>&#39;7.0.4&#39;</span>
  gem <span style=color:#e6db74>&#39;sqlite3&#39;</span>, <span style=color:#e6db74>&#39;1.5.4&#39;</span>
  gem <span style=color:#e6db74>&#39;activerecord-multi-tenant&#39;</span>, <span style=color:#e6db74>&#39;2.1.6&#39;</span>, require: <span style=color:#66d9ef>false</span>
  gem <span style=color:#e6db74>&#39;acts_as_tenant&#39;</span>, <span style=color:#e6db74>&#39;0.5.3&#39;</span>
  gem <span style=color:#e6db74>&#39;rspec-rails&#39;</span>
<span style=color:#66d9ef>end</span>

require <span style=color:#e6db74>&#39;action_controller/railtie&#39;</span>
require <span style=color:#e6db74>&#39;active_record&#39;</span>
<span style=color:#66d9ef>ActiveRecord</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Base</span><span style=color:#f92672>.</span>establish_connection(<span style=color:#e6db74>adapter</span>: <span style=color:#e6db74>&#39;sqlite3&#39;</span>, <span style=color:#e6db74>database</span>: <span style=color:#e6db74>&#39;:memory:&#39;</span>)

require <span style=color:#e6db74>&#39;activerecord-multi-tenant&#39;</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Rails</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Application</span>
  routes<span style=color:#f92672>.</span>append <span style=color:#66d9ef>do</span>
    get <span style=color:#e6db74>&#39;/tenant_test&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;tenant#test&#39;</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TenantController</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ActionController</span><span style=color:#f92672>::</span><span style=color:#66d9ef>API</span>
  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test</span>
    puts <span style=color:#e6db74>&#34;ActsAsTenant.current_tenant:  </span><span style=color:#e6db74>#{</span><span style=color:#66d9ef>ActsAsTenant</span><span style=color:#f92672>.</span>current_tenant<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
    puts <span style=color:#e6db74>&#34;ActsAsTenant.test_tenant:  </span><span style=color:#e6db74>#{</span><span style=color:#66d9ef>ActsAsTenant</span><span style=color:#f92672>.</span>test_tenant<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
    puts <span style=color:#e6db74>&#34;MultiTenant.current_tenant:  </span><span style=color:#e6db74>#{</span><span style=color:#66d9ef>MultiTenant</span><span style=color:#f92672>.</span>current_tenant<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>

    render <span style=color:#e6db74>json</span>: { <span style=color:#e6db74>hello</span>: <span style=color:#e6db74>:world</span> }
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>

<span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>configure <span style=color:#66d9ef>do</span>
  config<span style=color:#f92672>.</span>hosts<span style=color:#f92672>.</span>clear
<span style=color:#66d9ef>end</span>

require <span style=color:#e6db74>&#39;acts_as_tenant/test_tenant_middleware&#39;</span>

<span style=color:#66d9ef>Rails</span><span style=color:#f92672>.</span>application<span style=color:#f92672>.</span>configure <span style=color:#66d9ef>do</span>
  config<span style=color:#f92672>.</span>middleware<span style=color:#f92672>.</span>use <span style=color:#66d9ef>ActsAsTenant</span><span style=color:#f92672>::</span><span style=color:#66d9ef>TestTenantMiddleware</span>
<span style=color:#66d9ef>end</span>

<span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>initialize!

require <span style=color:#e6db74>&#39;rspec/rails&#39;</span>

<span style=color:#66d9ef>RSpec</span><span style=color:#f92672>.</span>describe <span style=color:#e6db74>&#39;Test&#39;</span>, <span style=color:#e6db74>type</span>: <span style=color:#e6db74>:request</span> <span style=color:#66d9ef>do</span>
  it <span style=color:#e6db74>&#39;first request&#39;</span> <span style=color:#66d9ef>do</span>
    <span style=color:#66d9ef>ActsAsTenant</span><span style=color:#f92672>.</span>current_tenant <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Tenant set in spec&#39;</span>
    <span style=color:#66d9ef>ActsAsTenant</span><span style=color:#f92672>.</span>test_tenant <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Tenant set in spec&#39;</span>
    <span style=color:#66d9ef>MultiTenant</span><span style=color:#f92672>.</span>current_tenant <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Tenant set in spec&#39;</span>

    get <span style=color:#e6db74>&#39;/tenant_test&#39;</span>

    expect(response<span style=color:#f92672>.</span>status)<span style=color:#f92672>.</span>to eq(<span style=color:#ae81ff>200</span>)
  <span style=color:#66d9ef>end</span>

  it <span style=color:#e6db74>&#39;second request&#39;</span> <span style=color:#66d9ef>do</span>
    get <span style=color:#e6db74>&#39;/tenant_test&#39;</span>

    expect(response<span style=color:#f92672>.</span>status)<span style=color:#f92672>.</span>to eq(<span style=color:#ae81ff>200</span>)
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>実行結果</p>
<pre tabindex=0><code>⋊&gt; ~/acts_as_tenant_sandbox rspec -f d script.rb      
Fetching gem metadata from https://rubygems.org/...........
###(中略)###

Test
ActsAsTenant.current_tenant:  Tenant set in spec
ActsAsTenant.test_tenant:  
MultiTenant.current_tenant:  
  first request
ActsAsTenant.current_tenant:  
ActsAsTenant.test_tenant:  
MultiTenant.current_tenant:  
  second request

Finished in 0.00789 seconds (files took 1.34 seconds to load)
2 examples, 0 failures
</code></pre><p>実行結果からわかる通り<code>ActsAsTenant.current_tenant</code>はテストコード内で設定したテナントがrequest specの機能で呼び出されたアプリケーションの中でも初期化されずに引き継がれていることがわかります。
この問題(？)については<code>ActsAsTenant</code>のREADMEにて記載があります。</p>
<blockquote>
<p>If you set the <code>current_tenant</code> in your tests, make sure to clean up the tenant after each test by calling <code>ActsAsTenant.current_tenant = nil</code>. Integration tests are more difficult: manually setting the <code>current_tenant</code> value will not survive across multiple requests, even if they take place within the same test. This can result in undesired boilerplate to set the desired tenant. Moreover, the efficacy of the test can be compromised because the set <code>current_tenant</code> value will carry over into the request-response cycle.</p>
</blockquote>
<p>また対処の方法としてサンプルコードでも使用していた<code>ActsAsTenant.test_tenant</code>の使用を推奨する記載もREADMEにあります。</p>
<h3 id=なぜ初期化するタイミングが違うのか>なぜ初期化するタイミングが違うのか
<span><a href=#%e3%81%aa%e3%81%9c%e5%88%9d%e6%9c%9f%e5%8c%96%e3%81%99%e3%82%8b%e3%82%bf%e3%82%a4%e3%83%9f%e3%83%b3%e3%82%b0%e3%81%8c%e9%81%95%e3%81%86%e3%81%ae%e3%81%8b>#</a></span>
</h3><p>なぜ初期化するタイミングが違うのかというと<code>ActsAsTenant</code>と<code>MultiTenant</code>ではテナントの保存に使用しているクラスが異なっているからです。</p>
<p><code>ActsAsTenant</code>は<code>RequestStore</code>を<a href=https://github.com/ErwinM/acts_as_tenant/blob/v0.5.3/lib/acts_as_tenant.rb#L59>使っています。</a></p>
<ul>
<li><a href=https://github.com/steveklabnik/request_store>https://github.com/steveklabnik/request_store</a></li>
</ul>
<p>対して<code>MultiTenant</code>は<code>ActiveSupport::CurrentAttributes</code>を<a href=https://github.com/citusdata/activerecord-multi-tenant/blob/a6c8c2d75230ac6ebb22a609d6f7fc57e5f250ee/lib/activerecord-multi-tenant/multi_tenant.rb#L60>使っています。</a></p>
<ul>
<li><a href=https://github.com/rails/rails/blob/v7.0.4/activesupport/lib/active_support/current_attributes.rb>https://github.com/rails/rails/blob/v7.0.4/activesupport/lib/active_support/current_attributes.rb</a></li>
</ul>
<p>どちらもThreadクラスを利用しつつリクエストごとに値を初期化してくれる場所を提供してくれるクラスですが、初期化を設定する方法が異なっています。</p>
<p><code>RequestStore</code>はRackに<a href=https://github.com/steveklabnik/request_store/blob/v1.5.1/lib/request_store/middleware.rb>値を初期化するミドルウェア</a>を追加しているのと、RailsのExecuterの<code>to_complite</code>コールバックに<a href=https://github.com/steveklabnik/request_store/blob/f79bd375e88f434428b876dbb5c8a51b569712aa/lib/request_store/railtie.rb#L10>値を初期化する動作が追加</a> されています。<br>
Executerのコールバックについての細かい解説は<a href=https://railsguides.jp/threading_and_code_execution.html#executor>Railsガイド</a>にあります（いつもありがとうございます！）。</p>
<p>ミドルウェアの中身は↓のようになっており、<code>RequestStore</code>はリクエストを処理した後にのみ値を初期化していることがわかります。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>call</span>(env)
  <span style=color:#66d9ef>RequestStore</span><span style=color:#f92672>.</span>begin!

  status, headers, body <span style=color:#f92672>=</span> @app<span style=color:#f92672>.</span>call(env)

  body <span style=color:#f92672>=</span> <span style=color:#66d9ef>Rack</span><span style=color:#f92672>::</span><span style=color:#66d9ef>BodyProxy</span><span style=color:#f92672>.</span>new(body) <span style=color:#66d9ef>do</span>
    <span style=color:#66d9ef>RequestStore</span><span style=color:#f92672>.</span>end!
    <span style=color:#66d9ef>RequestStore</span><span style=color:#f92672>.</span>clear!
  <span style=color:#66d9ef>end</span>
  <span style=color:#f92672>...</span>
</code></pre></div><p>対して<code>ActiveSupport::CurrentAttributes</code>ではRails のExecutorのコールバックである<code>to_run</code>と<code>to_complete</code>に<a href=https://github.com/rails/rails/blob/v7.0.4/activesupport/lib/active_support/railtie.rb#L41>値を初期化する動作を追加しています。</a><br>
先述のガイドにものっていますが、<code>to_run</code>コールバックはアプリケーションの実行前に呼び出されるコールバックです。</p>
<p>↓は超ざっくりイメージです。
<img src=/reset.png alt></p>
<h3 id=初期化されるタイミングの違いで起こりうること>初期化されるタイミングの違いで起こりうること
<span><a href=#%e5%88%9d%e6%9c%9f%e5%8c%96%e3%81%95%e3%82%8c%e3%82%8b%e3%82%bf%e3%82%a4%e3%83%9f%e3%83%b3%e3%82%b0%e3%81%ae%e9%81%95%e3%81%84%e3%81%a7%e8%b5%b7%e3%81%93%e3%82%8a%e3%81%86%e3%82%8b%e3%81%93%e3%81%a8>#</a></span>
</h3><p>request specで使えるようになる<code>get</code>等のメソッドはテストと同じスレッドで擬似的にRackアプリ全体を呼び出すため、<code>RequestStore</code>を使用している<code>ActsAsTenant.current_tenant</code>はテスト内で設定した<code>current_tenant</code>の値が初期化されずに引き継がれます。<br>
request specを統合テストと考えると事前にテナントが固定されたままテストするのはあまりよくないので<a href=https://github.com/ErwinM/acts_as_tenant/tree/v0.5.3#testing>リクエストを処理する前に値を初期化してくれるミドルウェアに対応している</a><code>ActsAsTenant.test_tenant</code>を使用したほうが良いでしょう。<br>
実は <code>activerecord-multi-tenant</code>も古いバージョンでは<code>RequestStore</code>を使用しており、<code>ActsAsTenant.current_tenant</code>と同様にrequest spec内で固定したテナントが<code>get</code>等で呼び出すアプリケーション内で初期化されず引き継がれるようになっていました。<br>
request specを書く際にはテストのためにデータを準備するコードでテナントを固定する箇所は発生すると思いますので、
テナントがスレッド内でどのように固定と初期化されているのか理解しておくことで間違ったテストを書く可能性が減らせると思います。</p>
</div>
<div class=post-info>
<div class="post-date dt-published">2022-12-07</div>
<a class="post-hidden-url u-url" href=https://qwyng.dev/posts/shr_advent_calendar2022/>https://qwyng.dev/posts/shr_advent_calendar2022/</a>
<a href=https://qwyng.dev class="p-name p-author post-hidden-author h-card" rel=me>QWYNG</a>
<div class=post-taxonomies>
</div>
</div>
</article>
<div class=inline-svg>
<a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fqwyng.dev%2fposts%2fshr_advent_calendar2022%2f&text=Rails%e3%81%a7%e3%82%88%e3%81%8f%e4%bd%bf%e7%94%a8%e3%81%95%e3%82%8c%e3%82%8b%e3%83%9e%e3%83%ab%e3%83%81%e3%83%86%e3%83%8a%e3%83%b3%e3%83%88Gem%e3%81%ae%e3%83%86%e3%83%8a%e3%83%b3%e3%83%88%e3%81%ae%e5%88%9d%e6%9c%9f%e5%8c%96%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%20%7c%20QWYNG.dev" target=_blank title=Tweet><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
</div>
<div class="pagination post-pagination">
<div class="left pagination-item">
<a href=/posts/20221212/>週報2022-W49 チームシールド</a>
</div>
<div class="right pagination-item">
<a href=/posts/20221204/>週報2022-W48 オーバーウォッチ2</a>
</div>
</div>
</main>
<footer class=common-footer>
<div class=common-footer-bottom>
<div class=copyright>
<p>© QWYNG, 2023<br>
Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br>
</p>
</div>
</div>
<p class="h-card vcard">
<a href=https://qwyng.dev class="p-name u-url url fn" rel=me>QWYNG</a>
</p>
</footer>
</div>
</body>
</html>